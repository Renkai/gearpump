define("echarts/chart/bar",["require","./base","zrender/shape/Rectangle","../component/axis","../component/grid","../component/dataZoom","../config","../util/ecData","zrender/tool/util","zrender/tool/color","../chart"],function(t){function e(t,e,o,r,n){i.call(this,t,e,o,r,n),this.refresh(r)}var i=t("./base"),o=t("zrender/shape/Rectangle");t("../component/axis"),t("../component/grid"),t("../component/dataZoom");var r=t("../config");r.bar={zlevel:0,z:2,clickable:!0,legendHoverLink:!0,xAxisIndex:0,yAxisIndex:0,barMinHeight:0,barGap:"30%",barCategoryGap:"20%",itemStyle:{normal:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}},emphasis:{barBorderColor:"#fff",barBorderRadius:0,barBorderWidth:0,label:{show:!1}}}};var n=t("../util/ecData"),s=t("zrender/tool/util"),a=t("zrender/tool/color");return e.prototype={type:r.CHART_TYPE_BAR,_buildShape:function(){this._buildPosition()},_buildNormal:function(t,e,i,n,s){for(var a,h,l,d,c,u,p,f,g,m,_,y,v=this.series,x=i[0][0],b=v[x],T="horizontal"==s,S=this.component.xAxis,z=this.component.yAxis,C=T?S.getAxis(b.xAxisIndex):z.getAxis(b.yAxisIndex),E=this._mapSize(C,i),w=E.gap,L=E.barGap,A=E.barWidthMap,M=E.barMaxWidthMap,k=E.barWidth,I=E.barMinHeightMap,P=E.interval,O=this.deepQuery([this.ecTheme,r],"island.r"),D=0,R=e;R>D&&null!=C.getNameByIndex(D);D++){T?d=C.getCoordByIndex(D)-w/2:c=C.getCoordByIndex(D)+w/2;for(var H=0,B=i.length;B>H;H++){var N=v[i[H][0]].yAxisIndex||0,F=v[i[H][0]].xAxisIndex||0;a=T?z.getAxis(N):S.getAxis(F),p=u=g=f=a.getCoord(0);for(var Y=0,W=i[H].length;W>Y;Y++)x=i[H][Y],b=v[x],_=b.data[D],y=this.getDataFromOption(_,"-"),n[x]=n[x]||{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY,sum:0,counter:0,average:0},l=Math.min(M[x]||Number.MAX_VALUE,A[x]||k),"-"!==y&&(y>0?(h=Y>0?a.getCoordSize(y):T?p-a.getCoord(y):a.getCoord(y)-p,1===W&&I[x]>h&&(h=I[x]),T?(u-=h,c=u):(d=u,u+=h)):0>y?(h=Y>0?a.getCoordSize(y):T?a.getCoord(y)-g:g-a.getCoord(y),1===W&&I[x]>h&&(h=I[x]),T?(c=f,f+=h):(f-=h,d=f)):(h=0,T?(u-=h,c=u):(d=u,u+=h)),n[x][D]=T?d+l/2:c-l/2,n[x].min>y&&(n[x].min=y,T?(n[x].minY=c,n[x].minX=n[x][D]):(n[x].minX=d+h,n[x].minY=n[x][D])),n[x].max<y&&(n[x].max=y,T?(n[x].maxY=c,n[x].maxX=n[x][D]):(n[x].maxX=d+h,n[x].maxY=n[x][D])),n[x].sum+=y,n[x].counter++,D%P===0&&(m=this._getBarItem(x,D,C.getNameByIndex(D),d,c-(T?0:l),T?l:h,T?h:l,T?"vertical":"horizontal"),this.shapeList.push(new o(m))));for(var Y=0,W=i[H].length;W>Y;Y++)x=i[H][Y],b=v[x],_=b.data[D],y=this.getDataFromOption(_,"-"),l=Math.min(M[x]||Number.MAX_VALUE,A[x]||k),"-"==y&&this.deepQuery([_,b,this.option],"calculable")&&(T?(u-=O,c=u):(d=u,u+=O),m=this._getBarItem(x,D,C.getNameByIndex(D),d,c-(T?0:l),T?l:O,T?O:l,T?"vertical":"horizontal"),m.hoverable=!1,m.draggable=!1,m.style.lineWidth=1,m.style.brushType="stroke",m.style.strokeColor=b.calculableHolderColor||this.ecTheme.calculableHolderColor||r.calculableHolderColor,this.shapeList.push(new o(m)));T?d+=l+L:c-=l+L}}this._calculMarkMapXY(n,i,T?"y":"x")},_buildHorizontal:function(t,e,i,o){return this._buildNormal(t,e,i,o,"horizontal")},_buildVertical:function(t,e,i,o){return this._buildNormal(t,e,i,o,"vertical")},_buildOther:function(t,e,i,r){for(var n=this.series,s=0,a=i.length;a>s;s++)for(var h=0,l=i[s].length;l>h;h++){var d=i[s][h],c=n[d],u=c.xAxisIndex||0,p=this.component.xAxis.getAxis(u),f=p.getCoord(0),g=c.yAxisIndex||0,m=this.component.yAxis.getAxis(g),_=m.getCoord(0);r[d]=r[d]||{min0:Number.POSITIVE_INFINITY,min1:Number.POSITIVE_INFINITY,max0:Number.NEGATIVE_INFINITY,max1:Number.NEGATIVE_INFINITY,sum0:0,sum1:0,counter0:0,counter1:0,average0:0,average1:0};for(var y=0,v=c.data.length;v>y;y++){var x=c.data[y],b=this.getDataFromOption(x,"-");if(b instanceof Array){var T,S,z=p.getCoord(b[0]),C=m.getCoord(b[1]),E=[x,c],w=this.deepQuery(E,"barWidth")||10,L=this.deepQuery(E,"barHeight");null!=L?(T="horizontal",b[0]>0?(w=z-f,z-=w):w=b[0]<0?f-z:0,S=this._getBarItem(d,y,b[0],z,C-L/2,w,L,T)):(T="vertical",b[1]>0?L=_-C:b[1]<0?(L=C-_,C-=L):L=0,S=this._getBarItem(d,y,b[0],z-w/2,C,w,L,T)),this.shapeList.push(new o(S)),z=p.getCoord(b[0]),C=m.getCoord(b[1]),r[d].min0>b[0]&&(r[d].min0=b[0],r[d].minY0=C,r[d].minX0=z),r[d].max0<b[0]&&(r[d].max0=b[0],r[d].maxY0=C,r[d].maxX0=z),r[d].sum0+=b[0],r[d].counter0++,r[d].min1>b[1]&&(r[d].min1=b[1],r[d].minY1=C,r[d].minX1=z),r[d].max1<b[1]&&(r[d].max1=b[1],r[d].maxY1=C,r[d].maxX1=z),r[d].sum1+=b[1],r[d].counter1++}}}this._calculMarkMapXY(r,i,"xy")},_mapSize:function(t,e,i){var o,r,n=this._findSpecialBarSzie(e,i),s=n.barWidthMap,a=n.barMaxWidthMap,h=n.barMinHeightMap,l=n.sBarWidthCounter,d=n.sBarWidthTotal,c=n.barGap,u=n.barCategoryGap,p=1;if(e.length!=l){if(i)o=t.getGap(),c=0,r=+(o/e.length).toFixed(2),0>=r&&(p=Math.floor(e.length/o),r=1);else if(o="string"==typeof u&&u.match(/%$/)?(t.getGap()*(100-parseFloat(u))/100).toFixed(2)-0:t.getGap()-u,"string"==typeof c&&c.match(/%$/)?(c=parseFloat(c)/100,r=+((o-d)/((e.length-1)*c+e.length-l)).toFixed(2),c=r*c):(c=parseFloat(c),r=+((o-d-c*(e.length-1))/(e.length-l)).toFixed(2)),0>=r)return this._mapSize(t,e,!0)}else if(o=l>1?"string"==typeof u&&u.match(/%$/)?+(t.getGap()*(100-parseFloat(u))/100).toFixed(2):t.getGap()-u:d,r=0,c=l>1?+((o-d)/(l-1)).toFixed(2):0,0>c)return this._mapSize(t,e,!0);return this._recheckBarMaxWidth(e,s,a,h,o,r,c,p)},_findSpecialBarSzie:function(t,e){for(var i,o,r,n,s=this.series,a={},h={},l={},d=0,c=0,u=0,p=t.length;p>u;u++)for(var f={barWidth:!1,barMaxWidth:!1},g=0,m=t[u].length;m>g;g++){var _=t[u][g],y=s[_];if(!e){if(f.barWidth)a[_]=i;else if(i=this.query(y,"barWidth"),null!=i){a[_]=i,c+=i,d++,f.barWidth=!0;for(var v=0,x=g;x>v;v++){var b=t[u][v];a[b]=i}}if(f.barMaxWidth)h[_]=o;else if(o=this.query(y,"barMaxWidth"),null!=o){h[_]=o,f.barMaxWidth=!0;for(var v=0,x=g;x>v;v++){var b=t[u][v];h[b]=o}}}l[_]=this.query(y,"barMinHeight"),r=null!=r?r:this.query(y,"barGap"),n=null!=n?n:this.query(y,"barCategoryGap")}return{barWidthMap:a,barMaxWidthMap:h,barMinHeightMap:l,sBarWidth:i,sBarMaxWidth:o,sBarWidthCounter:d,sBarWidthTotal:c,barGap:r,barCategoryGap:n}},_recheckBarMaxWidth:function(t,e,i,o,r,n,s,a){for(var h=0,l=t.length;l>h;h++){var d=t[h][0];i[d]&&i[d]<n&&(r-=n-i[d])}return{barWidthMap:e,barMaxWidthMap:i,barMinHeightMap:o,gap:r,barWidth:n,barGap:s,interval:a}},_getBarItem:function(t,e,i,o,r,s,h,l){var d,c=this.series,u=c[t],p=u.data[e],f=this._sIndex2ColorMap[t],g=[p,u],m=this.deepMerge(g,"itemStyle.normal"),_=this.deepMerge(g,"itemStyle.emphasis"),y=m.barBorderWidth;d={zlevel:u.zlevel,z:u.z,clickable:this.deepQuery(g,"clickable"),style:{x:o,y:r,width:s,height:h,brushType:"both",color:this.getItemStyleColor(this.deepQuery(g,"itemStyle.normal.color")||f,t,e,p),radius:m.barBorderRadius,lineWidth:y,strokeColor:m.barBorderColor},highlightStyle:{color:this.getItemStyleColor(this.deepQuery(g,"itemStyle.emphasis.color"),t,e,p),radius:_.barBorderRadius,lineWidth:_.barBorderWidth,strokeColor:_.barBorderColor},_orient:l};var v=d.style;d.highlightStyle.color=d.highlightStyle.color||("string"==typeof v.color?a.lift(v.color,-.3):v.color),v.x=Math.floor(v.x),v.y=Math.floor(v.y),v.height=Math.ceil(v.height),v.width=Math.ceil(v.width),y>0&&v.height>y&&v.width>y?(v.y+=y/2,v.height-=y,v.x+=y/2,v.width-=y):v.brushType="fill",d.highlightStyle.textColor=d.highlightStyle.color,d=this.addLabel(d,u,p,i,l);for(var x=[v,d.highlightStyle],b=0,T=x.length;T>b;b++){var S=x[b].textPosition;if("insideLeft"===S||"insideRight"===S||"insideTop"===S||"insideBottom"===S){var z=5;switch(S){case"insideLeft":x[b].textX=v.x+z,x[b].textY=v.y+v.height/2,x[b].textAlign="left",x[b].textBaseline="middle";break;case"insideRight":x[b].textX=v.x+v.width-z,x[b].textY=v.y+v.height/2,x[b].textAlign="right",x[b].textBaseline="middle";break;case"insideTop":x[b].textX=v.x+v.width/2,x[b].textY=v.y+z/2,x[b].textAlign="center",x[b].textBaseline="top";break;case"insideBottom":x[b].textX=v.x+v.width/2,x[b].textY=v.y+v.height-z/2,x[b].textAlign="center",x[b].textBaseline="bottom"}x[b].textPosition="specific",x[b].textColor=x[b].textColor||"#fff"}}return this.deepQuery([p,u,this.option],"calculable")&&(this.setCalculable(d),d.draggable=!0),n.pack(d,c[t],t,c[t].data[e],e,i),d},getMarkCoord:function(t,e){var i,o,r=this.series[t],n=this.xMarkMap[t],s=this.component.xAxis.getAxis(r.xAxisIndex),a=this.component.yAxis.getAxis(r.yAxisIndex);if(!e.type||"max"!==e.type&&"min"!==e.type&&"average"!==e.type)if(n.isHorizontal){i="string"==typeof e.xAxis&&s.getIndexByName?s.getIndexByName(e.xAxis):e.xAxis||0;var h=n[i];h=null!=h?h:"string"!=typeof e.xAxis&&s.getCoordByIndex?s.getCoordByIndex(e.xAxis||0):s.getCoord(e.xAxis||0),o=[h,a.getCoord(e.yAxis||0)]}else{i="string"==typeof e.yAxis&&a.getIndexByName?a.getIndexByName(e.yAxis):e.yAxis||0;var l=n[i];l=null!=l?l:"string"!=typeof e.yAxis&&a.getCoordByIndex?a.getCoordByIndex(e.yAxis||0):a.getCoord(e.yAxis||0),o=[s.getCoord(e.xAxis||0),l]}else{var d=null!=e.valueIndex?e.valueIndex:null!=n.maxX0?"1":"";o=[n[e.type+"X"+d],n[e.type+"Y"+d],n[e.type+"Line"+d],n[e.type+d]]}return o},refresh:function(t){t&&(this.option=t,this.series=t.series),this.backupShapeList(),this._buildShape()},addDataAnimation:function(t,e){function i(){g--,0===g&&e&&e()}for(var o=this.series,r={},s=0,a=t.length;a>s;s++)r[t[s][0]]=t[s];for(var h,l,d,c,u,p,f,g=0,s=this.shapeList.length-1;s>=0;s--)if(p=n.get(this.shapeList[s],"seriesIndex"),r[p]&&!r[p][3]&&"rectangle"===this.shapeList[s].type){if(f=n.get(this.shapeList[s],"dataIndex"),u=o[p],r[p][2]&&f===u.data.length-1){this.zr.delShape(this.shapeList[s].id);continue}if(!r[p][2]&&0===f){this.zr.delShape(this.shapeList[s].id);continue}"horizontal"===this.shapeList[s]._orient?(c=this.component.yAxis.getAxis(u.yAxisIndex||0).getGap(),d=r[p][2]?-c:c,h=0):(l=this.component.xAxis.getAxis(u.xAxisIndex||0).getGap(),h=r[p][2]?l:-l,d=0),this.shapeList[s].position=[0,0],g++,this.zr.animate(this.shapeList[s].id,"").when(this.query(this.option,"animationDurationUpdate"),{position:[h,d]}).done(i).start()}g||e&&e()}},s.inherits(e,i),t("../chart").define("bar",e),e});